---
import BaseLayout from "@layouts/BaseLayout.astro"
import Article from "@components/Article.astro"
import Dropdown from "@components/Dropdown.astro"
---

<BaseLayout title="RNN Language Model">
  <Article>
    <div style="display: flex; gap: 0.5rem; align-items: center;">
      <label for="prime" style="font-weight: bold;">Book:</label>
      <Dropdown id="prime" name="prime" style="padding: 0.25rem 0.5rem;"></Dropdown>
      <button id="generate" style="padding: 0.4rem 0.8rem;">Generate</button>
    </div>

    <div id="output" style="margin-top: 1rem; font-family: ui-monospace, Menlo, monospace;"></div>

    <script>
      const select = document.getElementById('prime');
      const button = document.getElementById('generate');
      const output = document.getElementById('output');

      //import { session } from "/src/scripts/ort_session"
      import { ort } from "@scripts/ort_session.js"
      //const session = await ort.InferenceSession.create('/bible-rnn/model.onnx');
      const model_assets = await fetch('/bible-rnn/model_assets.json').then(r => r.json());
      const idx2token = [...model_assets.specials, ...model_assets.chars]
      const token2idx = {}
      for (let i = 0; i < idx2token.length; i++) {
        token2idx[idx2token[i]] = i;
      }

      // Placeholder
      function sample(prime) {
        console.log('Prime Chars:', prime);
        console.log({idx2token})
        console.log({token2idx})
        console.log(session)
        output.textContent = `Prime Chars: ${prime}`;
      }

      button.addEventListener('click', () => {
        const selected = select.value;
        sample(selected);
      });
    </script>
  </Article>
</BaseLayout>
